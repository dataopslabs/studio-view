graph LR
    subgraph INPUT["Input"]
        VID["ğŸ“¹<br/>Video File"]
    end

    subgraph PREPROCESSING["Preprocessing"]
        FRAMES["ğŸ“Š<br/>Extract Frames"]
        AUDIO["ğŸ”Š<br/>Extract Audio"]
    end

    subgraph AI_ANALYSIS["AI Analysis<br/>Gemini 3"]
        GEMINI["ğŸ¤–<br/>Multimodal<br/>Analysis"]
    end

    subgraph WORKFLOW_OUTPUT["Workflow Understanding"]
        SYSDET["ğŸ”<br/>Systems<br/>Detected"]
        SCREENMAP["ğŸ–¥ï¸<br/>Screen<br/>Mappings"]
        WORKFLOW["ğŸ“‹<br/>Workflow<br/>Steps"]
    end

    subgraph SOP_GENERATION["SOP Generation"]
        SOP["ğŸ“„<br/>Structured SOP<br/>JSON"]
        STEPS["âœ…<br/>Process Steps<br/>Metadata"]
    end

    subgraph ECM_PROCESSING["ECM Processing"]
        ECMMAP["ğŸ—‚ï¸<br/>ECM Attribute<br/>Mapping"]
        EXTPLAN["ğŸ“‹<br/>Extraction<br/>Plan"]
    end

    subgraph DOCAI_EXTRACTION["Document Extraction<br/>Google DocAI"]
        DOCAI["ğŸ“‘<br/>Document<br/>AI Parser"]
        FIELDS["ğŸ“Š<br/>Extracted<br/>Fields"]
    end

    subgraph TRANSFORMATION["Data Transformation"]
        STRUCT["ğŸ”„<br/>Structured<br/>Format"]
        VALIDATE_DATA["âœ“<br/>Data<br/>Validation"]
    end

    subgraph DATABASE["Database Operations"]
        DB_ICON["ğŸ’¾<br/>Enterprise DB<br/>PostgreSQL"]
        DB_WRITE["ğŸ“<br/>Write<br/>Records"]
        DB_READ["ğŸ“–<br/>Read<br/>Verification"]
    end

    subgraph VALIDATION["Validation"]
        COMPARE["âš–ï¸<br/>Compare<br/>Metadata vs DB"]
        VAL_RESULT["âœ”ï¸/âŒ<br/>Validation<br/>Result"]
    end

    subgraph ADK_GENERATION["ADK Code Generation"]
        CODEGEN["ğŸ’»<br/>Generate<br/>ADK Code"]
        RUNNER["ğŸš€<br/>Python ADK<br/>Runner"]
    end

    subgraph OUTPUT["Output & Status"]
        STATUS["ğŸ“Š<br/>Execution<br/>Status"]
        REPORT["ğŸ“ˆ<br/>Validation<br/>Report"]
    end

    VID -->|"Extract"| FRAMES
    VID -->|"Extract"| AUDIO
    FRAMES -->|"Video Frames"| GEMINI
    AUDIO -->|"Audio Track"| GEMINI

    GEMINI -->|"Identifies"| SYSDET
    GEMINI -->|"Maps UI"| SCREENMAP
    GEMINI -->|"Detects"| WORKFLOW

    SYSDET -->|"Feed to"| SOP
    SCREENMAP -->|"Reference"| SOP
    WORKFLOW -->|"Generate"| SOP
    SOP -->|"Detailed"| STEPS

    STEPS -->|"Input"| ECMMAP
    STEPS -->|"Create"| EXTPLAN

    EXTPLAN -->|"Documents"| DOCAI
    DOCAI -->|"Extract"| FIELDS

    FIELDS -->|"Transform"| STRUCT
    STRUCT -->|"Validate"| VALIDATE_DATA

    VALIDATE_DATA -->|"Insert/Update"| DB_WRITE
    DB_WRITE -->|"Confirmation"| DB_ICON
    DB_ICON -->|"Query"| DB_READ

    DB_READ -->|"Retrieved Data"| COMPARE
    STEPS -->|"Source Data"| COMPARE
    COMPARE -->|"Result"| VAL_RESULT

    SYSDET -->|"Systems List"| CODEGEN
    STEPS -->|"Process Steps"| CODEGEN
    CODEGEN -->|"Generated Code"| RUNNER
    RUNNER -->|"Execution"| STATUS

    VAL_RESULT -->|"Include"| REPORT
    STATUS -->|"Aggregate"| REPORT
    REPORT -->|"Final Output"| OUTPUT

    style INPUT fill:#bbdefb,stroke:#0d47a1,stroke-width:2px,color:#000
    style PREPROCESSING fill:#c8e6c9,stroke:#1b5e20,stroke-width:2px,color:#000
    style AI_ANALYSIS fill:#fff9c4,stroke:#f57f17,stroke-width:2px,color:#000
    style WORKFLOW_OUTPUT fill:#f8bbd0,stroke:#880e4f,stroke-width:2px,color:#000
    style SOP_GENERATION fill:#e1bee7,stroke:#4a148c,stroke-width:2px,color:#000
    style ECM_PROCESSING fill:#ffccbc,stroke:#bf360c,stroke-width:2px,color:#000
    style DOCAI_EXTRACTION fill:#fff9c4,stroke:#f57f17,stroke-width:2px,color:#000
    style TRANSFORMATION fill:#c8e6c9,stroke:#1b5e20,stroke-width:2px,color:#000
    style DATABASE fill:#b3e5fc,stroke:#01579b,stroke-width:2px,color:#000
    style VALIDATION fill:#f8bbd0,stroke:#880e4f,stroke-width:2px,color:#000
    style ADK_GENERATION fill:#dcedc8,stroke:#33691e,stroke-width:2px,color:#000
    style OUTPUT fill:#ffe0b2,stroke:#e65100,stroke-width:2px,color:#000
